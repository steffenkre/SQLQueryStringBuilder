<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SQL Query String Builder</title>
  <style>
    :root {
      --bg: #0b1020;          /* deep navy */
      --panel: #111831;       /* card bg */
      --panel-2: #0e142a;     /* darker card */
      --text: #eaf0ff;        /* near white */
      --muted: #a9b4d0;       /* muted text */
      --brand: #6ea8fe;       /* blue */
      --brand-2: #8ed0f9;     /* cyan */
      --ok: #36d399;          /* green */
      --warn: #fbbf24;        /* amber */
      --danger: #fb7185;      /* rose */
      --ring: rgba(110, 168, 254, .35);
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 0%, #141b36 0%, var(--bg) 50%),
                  radial-gradient(1000px 700px at 90% 10%, #102042 0%, var(--bg) 60%),
                  linear-gradient(180deg, #0b1020 0%, #050814 100%);
      color: var(--text);
    }
    .container { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    .header { display:flex; align-items:center; justify-content:space-between; gap:14px; margin-bottom: 18px; }
    h1 { margin: 0; font-size: clamp(22px, 3.6vw, 34px); letter-spacing: .3px; }
    .subtitle { color: var(--muted); font-size: 14px; margin-top: 6px; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 960px) { .grid { grid-template-columns: 340px 1fr; } }

    .card { background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
            border: 1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); }
    .card h2 { font-size: 16px; letter-spacing: .4px; margin: 0; padding: 16px 18px; border-bottom: 1px solid rgba(255,255,255,.06); color:#e7edff; }
    .card .content { padding: 16px 18px; }

    label { display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], select, input[type="number"] {
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08);
      background: #0c1226; color: var(--text); outline: none; transition: box-shadow .2s, border-color .2s;
    }
    input[type="text"]:focus, select:focus, input[type="number"]:focus { box-shadow: 0 0 0 4px var(--ring); border-color: var(--brand); }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .row-3 { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 12px; }
    .row-auto { display:flex; gap: 10px; flex-wrap: wrap; }
    .muted { color: var(--muted); font-size: 12px; }

    .buttonwrapper{
        padding-top: 1em;
    }
    .buttonwrapper button{
        width: 100%;
    }

    .btn { appearance: none; border: 1px solid rgba(255,255,255,.08); background: #101734; color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; box-shadow: var(--shadow); }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .btn-ghost { background: transparent; border-color: rgba(255,255,255,.12); }
    .btn-brand { background: linear-gradient(180deg, var(--brand) 0%, var(--brand-2) 100%); color: #061228; border-color: rgba(255,255,255,0); }

    .list { display:flex; flex-direction: column; gap: 10px; }
    .item { display:grid; grid-template-columns: 1fr 120px 120px 40px; gap: 10px; align-items: center; }
    .item.where { grid-template-columns: 1fr 130px 1fr 40px; }
    .icon-btn { 
        width: 36px;
        height: 36px;
        color: var(--text);
        display:grid; place-items:center; border-radius: 10px; border: 1px solid rgba(255,255,255,.1); background:#0d1430; cursor:pointer;
    }

    pre, code, textarea { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .output pre { margin: 0; padding: 16px; background:#0a0f22; border-radius: 14px; border:1px solid rgba(255,255,255,.06); overflow:auto; }

    .pill { display:inline-flex; align-items:center; gap:8px; font-size: 12px; padding: 6px 10px; background:#0e1735; border-radius:999px; border:1px solid rgba(255,255,255,.08); }
    .kbd { font-weight:700; color:#d5e2ff; background:#0a1026; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.08); }

    .footer { margin-top: 18px; color:var(--muted); font-size:12px; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>SQL Query String Builder</h1>
        <div class="subtitle">Erstelle sichere, parametrisierte SQL‑Strings und Code‑Snippets für JavaScript, PHP oder Python. Unterstützt MySQL & SQLite, CRUD, Spaltenangaben und Platzhalter‑Formate.</div>
      </div>
      
    </div>

    <div class="grid">
      <!-- LEFT: Controls -->
      <div class="card">
        <h2>Konfiguration</h2>
        <div class="content">
          <div class="row">
            <div>
              <label for="language">Zielsprache</label>
              <select id="language">
                <option>JavaScript</option>
                <option>PHP</option>
                <option>Python</option>
                <option>Go</option>
              </select>
            </div>
            <div>
              <label for="dbType">Datenbank</label>
              <select id="dbType">
                <option>MySQL</option>
                <option>SQLite</option>
              </select>
            </div>
          </div>
          <div class="row" style="margin-top:12px">
            <div>
              <label for="method">Methode</label>
              <select id="method">
                <option value="create">create (INSERT)</option>
                <option value="read">read (SELECT)</option>
                <option value="update">update (UPDATE)</option>
                <option value="delete">delete (DELETE)</option>
              </select>
            </div>
            <div>
              <label for="placeholder">Platzhalter‑Format</label>
              <select id="placeholder">
                <option value="?">? (positional)</option>
                <option value="%s">%s</option>
                <option value="%d">%d</option>
                <option value=":named">:name (benannt)</option>
              </select>
            </div>
          </div>
          <div style="margin-top:12px">
            <label for="table">Tabellenname</label>
            <input id="table" type="text" placeholder="z.B. users" />
          </div>
        </div>
      </div>

      <!-- RIGHT: Builder -->
      <div class="card">
        <h2>Spalten & Bedingungen</h2>
        <div class="content">
          <div class="row">
            <div>
              <label>SELECT Spalten (für read) — leer = *</label>
              <input id="selectCols" type="text" placeholder="z.B. id, name, email" />
            </div>
            <div class="row" style="gap:10px">
              <div>
                <label>ORDER BY</label>
                <input id="orderBy" type="text" placeholder="z.B. created_at DESC" />
              </div>
              <div>
                <label>LIMIT</label>
                <input id="limit" type="number" min="1" placeholder="z.B. 100" />
              </div>
            </div>
          </div>

          <div style="margin-top:16px">
            <div class="row-auto" style="justify-content:space-between; align-items:center;">
              <div class="pill">SET / INSERT Werte</div>
              <button class="btn btn-ghost" id="addSet">+ Spalte hinzufügen</button>
            </div>
            <div id="setList" class="list" style="margin-top:10px"></div>
          </div>

          <div style="margin-top:18px">
            <div class="row-auto" style="justify-content:space-between; align-items:center;">
              <div class="pill">WHERE Bedingungen</div>
              <button class="btn btn-ghost" id="addWhere">+ Bedingung hinzufügen</button>
            </div>
            <div id="whereList" class="list" style="margin-top:10px"></div>
          </div>

        </div>
      </div>
    </div>
    <div class="buttonwrapper">
        <button class="btn btn-brand" id="generateBtn">SQL & Code generieren</button>
    </div>
    <!-- OUTPUT -->
    <div class="card" style="margin-top:16px">
      <h2>Ausgabe</h2>
      <div class="content output">
        <div class="row">
          <div>
            <label>SQL (parametrisiert)</label>
            <pre id="sqlOut">/* Dein SQL erscheint hier */</pre>
          </div>
          <div>
            <label>Parameter</label>
            <pre id="paramsOut">/* Parameter erscheinen hier (Array oder Objekt) */</pre>
          </div>
        </div>
        <div style="margin-top:12px">
          <label>Code‑Snippet (<span id="snippetMeta">–</span>)</label>
          <pre id="codeOut">/* Code‑Beispiel erscheint hier */</pre>
        </div>
      </div>
    </div>

    <div class="footer">
      Made with a little ♥️
    </div>
  </div>

  <template id="setRowTpl">
    <div class="item">
      <input type="text" placeholder="Spaltenname" class="colName" />
      <select class="operator">
        <option value="=">=</option>
        <option value=">">&gt;</option>
        <option value=">=">&gt;=</option>
        <option value="<">&lt;</option>
        <option value="<=">&lt;=</option>
      </select>
      <input type="text" placeholder="Parameter‑Key / Beispielwert" class="paramKey" />
      <button class="icon-btn" title="Entfernen" data-action="remove">✕</button>
    </div>
  </template>

  <template id="whereRowTpl">
    <div class="item where">
      <input type="text" placeholder="Spaltenname" class="colName" />
      <select class="operator">
        <option value="=">=</option>
        <option value=">">&gt;</option>
        <option value=">=">&gt;=</option>
        <option value="<">&lt;</option>
        <option value="<=">&lt;=</option>
        <option value="LIKE">LIKE</option>
      </select>
      <input type="text" placeholder="Parameter‑Key / Beispielwert" class="paramKey" />
      <button class="icon-btn" title="Entfernen" data-action="remove">✕</button>
    </div>
  </template>

  <script>
    const el = (id) => document.getElementById(id);
    const setList = el('setList');
    const whereList = el('whereList');
    const setRowTpl = el('setRowTpl');
    const whereRowTpl = el('whereRowTpl');

    const addRow = (tpl, parent) => {
      const node = tpl.content.firstElementChild.cloneNode(true);
      node.querySelector('[data-action="remove"]').addEventListener('click', () => node.remove());
      parent.appendChild(node);
    };

    el('addSet').addEventListener('click', () => addRow(setRowTpl, setList));
    el('addWhere').addEventListener('click', () => addRow(whereRowTpl, whereList));

    // Start with one row each
    addRow(setRowTpl, setList);
    addRow(whereRowTpl, whereList);

    const getRows = (parent) => {
      return [...parent.querySelectorAll('.item')].map(item => ({
        col: item.querySelector('.colName').value.trim(),
        op: item.querySelector('.operator').value,
        key: item.querySelector('.paramKey').value.trim(),
      })).filter(r => r.col);
    };

    const buildPlaceholder = (style, key, index) => {
      switch(style){
        case '?': return '?';
        case '%s': return '%s';
        case '%d': return '%d';
        case ':named': return ':' + (key || ('p'+(index+1)));
        default: return '?';
      }
    };

    const buildParams = (style, rows) => {
      if(style === ':named'){
        const obj = {};
        rows.forEach((r,i) => {
          const k = r.key || ('p'+(i+1));
          obj[k] = `/* ${r.col} */`;
        });
        return obj;
      }
      // positional
      return rows.map(r => `/* ${r.col} */`);
    };

    const q = {
      create({table, sets, placeholder}){
            const cols = sets.map(s=>`\`${s.col}\``).join(', ');
            const vals = sets.map((s,i)=>buildPlaceholder(placeholder, s.key, i)).join(', ');
            return `INSERT INTO \`${table}\` (${cols})\nVALUES (${vals});`;
        },
            read({table, selects, wheres, orderBy, limit, placeholder}){
            const sel = selects.length ? selects.join(', ') : '*';
            const where = wheres.length ? ('\nWHERE ' + wheres.map((w,i)=>`\`${w.col}\` ${w.op} ${buildPlaceholder(placeholder, w.key, i)}`).join(' AND ')) : '';
            const order = orderBy ? ('\nORDER BY ' + orderBy) : '';
            const lim = limit ? ('\nLIMIT ' + Number(limit)) : '';
            return `SELECT ${sel} FROM \`${table}\`${where}${order}${lim};`;
        },
            update({table, sets, wheres, placeholder}){
            const set = sets.map((s,i)=>`\`${s.col}\` = ${buildPlaceholder(placeholder, s.key, i)}`).join(', ');
            const where = wheres.length ? ('\nWHERE ' + wheres.map((w,i)=>`\`${w.col}\` ${w.op} ${buildPlaceholder(placeholder, w.key, sets.length + i)}`).join(' AND ')) : '';
            return `UPDATE \`${table}\`\nSET ${set}${where};`;
        },
            delete({table, wheres, placeholder}){
            const where = wheres.length ? ('\nWHERE ' + wheres.map((w,i)=>`\`${w.col}\` ${w.op} ${buildPlaceholder(placeholder, w.key, i)}`).join(' AND ')) : '';
            return `DELETE FROM \`${table}\`${where};`;
        },
    };

    const buildSnippet = ({language, dbType, placeholder, sql, setRows, whereRows}) => {
      const allRows = [...setRows, ...whereRows];
      const paramObj = buildParams(placeholder, allRows);
      const meta = `${language} • ${dbType} • Platzhalter: ${placeholder}`;

      const jsStringify = (v) => JSON.stringify(v, null, 2);

      let code = '';
      if(language === 'JavaScript'){
        if(dbType === 'MySQL'){
          code = `// mit mysql2 (Node.js)\nimport mysql from 'mysql2/promise';\nconst pool = mysql.createPool({ host:'localhost', user:'root', database:'test' });\n\nconst sql = ${JSON.stringify(sql)};\nconst params = ${jsStringify(paramObj)};\nconst [rows] = await pool.execute(sql, params);`;
        } else { // SQLite mit Node.js nativem sqlite
          code = `// mit sqlite3 (Node.js native)\nimport sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\n\nconst db = await open({ filename: 'app.db', driver: sqlite3.Database });\n\nconst sql = ${JSON.stringify(sql)};\nconst params = ${jsStringify(paramObj)};\n\n// für SELECT
                if(sql.trim().toUpperCase().startsWith('SELECT')) {
                const rows = await db.all(sql, params);
                } else {
                await db.run(sql, params);
                }`;
        }
      }
      else if(language === 'PHP'){
        // ... (PHP-Code bleibt unverändert) ...
      }
      else if(language === 'Python'){
        // ... (Python-Code bleibt unverändert) ...
      }
      else if(language === 'Go'){
        if(dbType === 'MySQL'){
          code = `// mit Go sql + MySQL Treiber\nimport (\n  "database/sql"\n  _ "github.com/go-sql-driver/mysql"\n  "log"\n)\n\nfunc main() {\n  db, err := sql.Open("mysql", "user:pass@tcp(localhost:3306)/test")\n  if err != nil { log.Fatal(err) }\n  defer db.Close()\n\n  sqlStr := ${JSON.stringify(sql)}\n  params := []interface{}{ /* TODO: Werte einsetzen */ }\n\n  rows, err := db.Query(sqlStr, params...)\n  if err != nil { log.Fatal(err) }\n  defer rows.Close()\n}`;
        } else { // SQLite
          code = `// mit Go sql + SQLite Treiber\nimport (\n  "database/sql"\n  _ "github.com/mattn/go-sqlite3"\n  "log"\n)\n\nfunc main() {\n  db, err := sql.Open("sqlite3", "app.db")\n  if err != nil { log.Fatal(err) }\n  defer db.Close()\n\n  sqlStr := ${JSON.stringify(sql)}\n  params := []interface{}{ /* TODO: Werte einsetzen */ }\n\n  rows, err := db.Query(sqlStr, params...)\n  if err != nil { log.Fatal(err) }\n  defer rows.Close()\n}`;
        }
      }

      return { meta, code, params: paramObj };
    };

    const build = () => {
      const language = el('language').value;
      const dbType = el('dbType').value;
      const method = el('method').value;
      const placeholder = el('placeholder').value;
      const table = el('table').value.trim();
      const selects = el('selectCols').value.split(',').map(s=>s.trim()).filter(Boolean);
      const orderBy = el('orderBy').value.trim();
      const limit = el('limit').value.trim();

      if(!table){
        el('sqlOut').textContent = 'Bitte einen Tabellennamen angeben.';
        el('paramsOut').textContent = '';
        el('codeOut').textContent = '';
        el('snippetMeta').textContent = '–';
        return;
      }

      const setRows = getRows(setList);
      const whereRows = getRows(whereList);

      let sql = '';
      if(method === 'create'){
        if(!setRows.length){ el('sqlOut').textContent = 'Für INSERT mindestens eine Spalte angeben.'; return; }
        sql = q.create({table, sets: setRows, placeholder});
      }
      if(method === 'read'){
        sql = q.read({table, selects, wheres: whereRows, orderBy, limit, placeholder});
      }
      if(method === 'update'){
        if(!setRows.length){ el('sqlOut').textContent = 'Für UPDATE mindestens eine SET‑Spalte angeben.'; return; }
        sql = q.update({table, sets: setRows, wheres: whereRows, placeholder});
      }
      if(method === 'delete'){
        sql = q.delete({table, wheres: whereRows, placeholder});
      }

      const { meta, code, params } = buildSnippet({language, dbType, placeholder, sql, setRows, whereRows});

      el('sqlOut').textContent = sql;
      el('paramsOut').textContent = (typeof params === 'string') ? params : JSON.stringify(params, null, 2);
      el('codeOut').textContent = code;
      el('snippetMeta').textContent = meta;
    };

    el('generateBtn').addEventListener('click', build);
  </script>
</body>
</html>
